var Gallery=new Class({initialize:function(c,a){this.container=c||alert("No element ID given to Gallery constructor");this.current_image=0;if("array"==typeOf(a.images))this.images=a.images,window.addEvent("domready",this.create.bind(this));else if("string"==typeOf(a.images)){var b=this;(new Request.JSON({method:"get",secure:!0,encoding:"utf-8",url:a.images,onSuccess:function(a){b.images=a;window.addEvent("domready",b.create.bind(b))},onError:function(a,b){alert("Error obtaining json: "+b)},onFailure:function(a,
b){alert("Failure obtaining json: "+b)}})).get()}else alert("No recognizable list of images or URL provided")},create:function(c){document.id(this.container).addClass("gallery");var a=this;this.viewer=(new Element("div",{"class":"viewer"})).inject(this.container);var b=(new Element("div",{"class":"thumbnails",events:{mousewheel:function(a){var c=a.wheel,d=b.getScroll().x;b.scrollTo(d-40*c);a.preventDefault()}}})).inject(this.container);new Drag(b,{style:!1,invert:!0,modifiers:{x:"scrollLeft"}});
this.thumbnails=(new Element("div",{events:{"click:relay(img)":function(b,c){var d=parseInt(c.get("id").substr(10));d!=a.current_image&&(a.thumbnails.getElement("img#thumbnail_"+a.current_image).removeClass("selected"),a.images[a.current_image].view={x:(a.iipmooviewer.view.x+a.iipmooviewer.view.w/2)/a.iipmooviewer.wid,y:(a.iipmooviewer.view.y+a.iipmooviewer.view.h/2)/a.iipmooviewer.hei,resolution:a.iipmooviewer.view.res},a.current_image=d,a.updateViewer(a.images[d]),c.addClass("selected"))}}})).inject(b);
this.createViewer();this.createThumbnails()},createThumbnails:function(){var c=Math.floor(this.thumbnails.getParent().getSize().y)-20,a=this.thumbnails;Array.each(this.images,function(b,e){var f=(new Element("img",{src:(b.server||"/fcgi-bin/iipsrv.fcgi")+"?FIF="+b.image+"&HEI="+c+"&WID="+2*c+"&CVT=JPEG",id:"thumbnail_"+e,title:b.title||null})).inject(a);0==e&&f.addClass("selected")})},createViewer:function(c){this.iipmooviewer=new IIPMooViewer(this.viewer,{server:this.images[0].server||null,image:this.images[0].image,
credit:this.images[0].caption,scale:this.images[0].scale||null})},updateViewer:function(c){this.iipmooviewer.server=c.server||null;this.iipmooviewer.setCredit(c.caption);this.iipmooviewer.viewport=c.view||null;this.iipmooviewer.changeImage(c.image)}});
